<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <style type="text/css">
      body {
        margin: 0;
        padding: 0;
        background-color: #222;
        overflow: hidden;
      }
      .centre {
        display: flex;
        justify-content: center;
        align-items: center;
      }
      .grid {
        display: grid;
        grid-template-columns: 50% 50%;
      }
      iframe {
        height: 100vh;
        width: 100%;
        border: none;
      }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.js" integrity="sha512-xwrAU5yhWwdTvvmMNheFn9IyuDbl/Kyghz2J3wQRDR8tyNmT8ZIYOd0V3iPYY/g4XdNPy0n/g0NvqGu9f0fPJQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/mode/ruby/ruby.min.js" integrity="sha512-DDpu1xN1YAdmcA+xz20oyK9KZA6UaKMMX7+jMVoESGrDyxhFlycDBN8ez63Ns2l5DRAa/x1hoyMtZcHgbQ9cXw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/codemirror.min.css" integrity="sha512-uf06llspW44/LZpHzHT6qBOIVODjWtv4MxCricRxkzvopAlSWnTf6hpZTFxuuZcuNE9CBQhqE0Seu1CoRk84nQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.2/theme/3024-night.min.css" integrity="sha512-SbB0juc9/nEA5PEN7S+lnglc7wADe2DLKZKXn3D+eyebL06fTbFHNzgMlpX9oqFjWEKZ6uH7zNCUSv+j9Dpwpw==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lz-string/1.4.4/lz-string.min.js" integrity="sha512-qoCTmFwBtCPvFhA+WAqatSOrghwpDhFHxwAGh+cppWonXbHA09nG1z5zi4/NGnp8dUhXiVrzA6EnKgJA+fyrpw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  </head>
  <body>
    <div class="grid">
      <div class="left">
        <div class="toolbar">
          <button id="run">Run</button>
          <button id="link">Generate Link</button>
        </div>
        <textarea id="code">
def main
  delta = get_frame_time

  drawing do

    clear
    draw_text(
      "Welcome to your first Taylor application!",
      190, 200, 20, DARKGRAY
    )
  end
end
        </textarea>
      </div>

      <iframe class="right" src="/exports/index.html"></iframe>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        document.querySelector('#run').addEventListener('click', () => { runCode(); });
        document.querySelector('#link').addEventListener('click', () => { generateLink(); });

        const codeArea = document.querySelector('#code');

        if (getCodeFromURL()) {
          codeArea.value = getCodeFromURL();
        }

        const code = CodeMirror.fromTextArea(
          codeArea, {
            lineNumbers: true
          });
        code.on('change', () => { code.save(); });
              code.setSize("100%", "100%");
        runCode();
      });

      function getCodeFromURL() {
        const params = new URLSearchParams(window.location.search);
        let code = params.get('code');

        if (code) { code = LZString.decompressFromEncodedURIComponent(code) };

        return code;
      }

      function runCode() {
        const iframe = document.querySelector('iframe');
        const code = document.querySelector('#code').value;
        const uri = new URL(iframe.src);
        const params = new URLSearchParams(uri.search);
        params.set('code', LZString.compressToEncodedURIComponent(code));
        uri.search = params;

        iframe.src = uri;
      }

      function generateLink() {
        const code = document.querySelector('#code').value;
        const params = new URLSearchParams(window.location.search);
        params.set('code', LZString.compressToEncodedURIComponent(code));
        window.location.search = params;
      }
    </script>
  </body>
</html>
