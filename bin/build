#!/usr/bin/env ruby

require "json"

def read_all(files)
  result = {}
  Dir.glob(files).each { |file|
    result[File.basename(file)] = File.read(file)
  }

  result
end

examples = {
  "v0.4.0" => read_all("app/playgrounds/v0.4/examples/*.rb"),
  "v0.3.14.1" => read_all("app/playgrounds/v0.3/examples/*.rb"),
}

File.write(
  "app/javascripts/lib/example_data.ts",
  <<~TYPESCRIPT)
    export const ExampleData = {
      codeFor: (version: string, example: string) => ExampleData.data[version][example],
      versions: () => Object.keys(ExampleData.data),
      initialVersion: (): string => ExampleData.versions()[0],
      examplesFor: (version: string) => Object.keys(ExampleData.data[version]),

      data: #{JSON.pretty_generate(examples)},
    }
  TYPESCRIPT
