#!/usr/bin/env ruby

require "json"

examples = {}

# Eventually consider moving this to JSON files split by version and loaded on
# demand, for now though, one big Javascript file for simplicity.
Dir.glob("examples/v*/*.rb").each do |path|
  _, version, example = path.split("/")

  puts "Processing '#{path}'"
  examples[version] ||= {}
  examples[version][example] = File.read(path)
end

File.write(
  "app/javascripts/lib/example_data.ts",
  <<~TYPESCRIPT)
    export const ExampleData = {
      codeFor: (version: string, example: string) => ExampleData.data[version][example],
      versions: () => Object.keys(ExampleData.data).reverse(),
      initialVersion: (): string => ExampleData.versions()[0],
      examplesFor: (version: string) => Object.keys(ExampleData.data[version]),

      data: #{JSON.pretty_generate(examples)},
    }
  TYPESCRIPT
