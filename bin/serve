#!/usr/bin/env bash
set -euo pipefail

clean() {
  rm -rf exports/*
}

setup-folders() {
  mkdir -p public/playground
}

build-assets() {
  ./bin/build
  npm run build
}

build-playground() {
  taylor export
  pushd exports
  unzip "*-web-*.zip"
  mv \
    index.html \
    playground.data \
    playground.js \
    playground.wasm \
    ../public/playground
  popd
}

build() {
  build-assets
  build-playground
}

serve() {
  pushd public
  ruby -run -e httpd . --port ${PORT:-3001}
  popd
}

clean
setup-folders
build
serve
